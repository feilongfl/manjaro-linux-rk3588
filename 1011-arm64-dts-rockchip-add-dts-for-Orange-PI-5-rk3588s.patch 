From 83363c2cdd622e98c7a904974a5cdab71cba109b Mon Sep 17 00:00:00 2001
From: spikerguy <48839029+spikerguy@users.noreply.github.com>
Date: Sun, 19 Feb 2023 00:22:27 +0300
Subject: [PATCH] arm64: dts: rockchip: add gmac to opi5

Orange Pi 5 uses YT8531C on gmac phy so motorcom drivers are needed from 6.3-rc

Signed-off-by: spikerguy <48839029+spikerguy@users.noreply.github.com>
---
 .../boot/dts/rockchip/rk3588s-orangepi-5.dts  | 33 +++++++++++++++++++
 1 file changed, 33 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk3588s-orangepi-5.dts b/arch/arm64/boot/dts/rockchip/rk3588s-orangepi-5.dts
index f9e38f004a87..20168aa259d7 100644
--- a/arch/arm64/boot/dts/rockchip/rk3588s-orangepi-5.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3588s-orangepi-5.dts
@@ -122,6 +122,39 @@
 	status = "disabled";
 };
 
+&gmac1 {
+	/* Use rgmii-rxid mode to disable rx delay inside Soc */
+	phy-mode = "rgmii-rxid";
+	clock_in_out = "output";
+
+	snps,reset-gpio = <&gpio3 RK_PB2 GPIO_ACTIVE_LOW>;
+	snps,reset-active-low;
+	/* Reset time is 20ms, 100ms for rtl8211f */
+	snps,reset-delays-us = <0 20000 100000>;
+
+	pinctrl-names = "default";
+	pinctrl-0 = <&gmac1_miim
+	             &gmac1_tx_bus2
+	             &gmac1_rx_bus2
+	             &gmac1_rgmii_clk
+	             &gmac1_rgmii_bus>;
+
+	/* tx_delay = <0x42>; BSP */ 
+	/* rx_delay = <0x3f>; BSP */ 
+	tx_delay = <0x3a>;
+	rx_delay = <0x3e>;
+
+	phy-handle = <&rgmii_phy1>;
+	status = "okay";
+};
+
+&mdio1 {
+	rgmii_phy1: phy@1 {
+		compatible = "ethernet-phy-ieee802.3-c22";
+		reg = <0x1>;
+	};
+};
+
 &i2c0 {
 	status = "disabled";
 	pinctrl-names = "default";
